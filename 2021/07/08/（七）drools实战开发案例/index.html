<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>（七）drools实战开发案例 | 海元的小站</title><meta name="keywords" content="规则引擎,drools"><meta name="author" content="Diao HaiYuan"><meta name="copyright" content="Diao HaiYuan"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Drools实战开发案例1 个人所得税计算器本小节我们需要通过Drools规则引擎来根据规则计算个人所得税，最终页面效果如下：  1.1 名词解释税前月收入：即税前工资，指交纳个人所得税之前的总工资 应纳税所得额：指按照税法规定确定纳税人在一定期间所获得的所有应税收入减除在该纳税期间依法允许减除的各种支出后的余额 税率：是对征税对象的征收比例或征收额度 速算扣除数：指为解决超额累进税率分级计算税额">
<meta property="og:type" content="article">
<meta property="og:title" content="（七）drools实战开发案例">
<meta property="og:url" content="https://diaohaiyuan.github.io/2021/07/08/%EF%BC%88%E4%B8%83%EF%BC%89drools%E5%AE%9E%E6%88%98%E5%BC%80%E5%8F%91%E6%A1%88%E4%BE%8B/index.html">
<meta property="og:site_name" content="海元的小站">
<meta property="og:description" content="Drools实战开发案例1 个人所得税计算器本小节我们需要通过Drools规则引擎来根据规则计算个人所得税，最终页面效果如下：  1.1 名词解释税前月收入：即税前工资，指交纳个人所得税之前的总工资 应纳税所得额：指按照税法规定确定纳税人在一定期间所获得的所有应税收入减除在该纳税期间依法允许减除的各种支出后的余额 税率：是对征税对象的征收比例或征收额度 速算扣除数：指为解决超额累进税率分级计算税额">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://diaohaiyuan.github.io/2021/07/08/%EF%BC%88%E4%B8%83%EF%BC%89drools%E5%AE%9E%E6%88%98%E5%BC%80%E5%8F%91%E6%A1%88%E4%BE%8B/drools.webp">
<meta property="article:published_time" content="2021-07-08T06:57:38.000Z">
<meta property="article:modified_time" content="2021-07-08T07:07:05.644Z">
<meta property="article:author" content="Diao HaiYuan">
<meta property="article:tag" content="规则引擎">
<meta property="article:tag" content="drools">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://diaohaiyuan.github.io/2021/07/08/%EF%BC%88%E4%B8%83%EF%BC%89drools%E5%AE%9E%E6%88%98%E5%BC%80%E5%8F%91%E6%A1%88%E4%BE%8B/drools.webp"><link rel="shortcut icon" href="/img/touxiang.jpg"><link rel="canonical" href="https://diaohaiyuan.github.io/2021/07/08/%EF%BC%88%E4%B8%83%EF%BC%89drools%E5%AE%9E%E6%88%98%E5%BC%80%E5%8F%91%E6%A1%88%E4%BE%8B/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#121212","position":"bottom-left"},
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '（七）drools实战开发案例',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2021-07-08 15:07:05'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    })(window)</script><meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="海元的小站" type="application/atom+xml">
</head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" src="/img/touxiang.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">22</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">31</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">15</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background: transparent"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">海元的小站</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">（七）drools实战开发案例</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2021-07-08T06:57:38.000Z" title="发表于 2021-07-08 14:57:38">2021-07-08</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2021-07-08T07:07:05.644Z" title="更新于 2021-07-08 15:07:05">2021-07-08</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/drools/">drools</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="（七）drools实战开发案例"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h2 id="Drools实战开发案例"><a href="#Drools实战开发案例" class="headerlink" title="Drools实战开发案例"></a>Drools实战开发案例</h2><h3 id="1-个人所得税计算器"><a href="#1-个人所得税计算器" class="headerlink" title="1 个人所得税计算器"></a>1 个人所得税计算器</h3><p>本小节我们需要通过Drools规则引擎来根据规则计算个人所得税，最终页面效果如下：</p>
<p><img src="/2021/07/08/%EF%BC%88%E4%B8%83%EF%BC%89drools%E5%AE%9E%E6%88%98%E5%BC%80%E5%8F%91%E6%A1%88%E4%BE%8B/image-20200214132448956.png"></p>
<h4 id="1-1-名词解释"><a href="#1-1-名词解释" class="headerlink" title="1.1 名词解释"></a>1.1 名词解释</h4><p>税前月收入：即税前工资，指交纳个人所得税之前的总工资</p>
<p>应纳税所得额：指按照税法规定确定纳税人在一定期间所获得的所有应税收入减除在该纳税期间依法允许减除的各种支出后的余额</p>
<p>税率：是对征税对象的征收比例或征收额度</p>
<p>速算扣除数：指为解决超额累进税率分级计算税额的复杂技术问题，而预先计算出的一个数据，可以简化计算过程</p>
<p>扣税额：是指实际缴纳的税额</p>
<p>税后工资：是指扣完税后实际到手的工资收入</p>
<h4 id="1-2-计算规则"><a href="#1-2-计算规则" class="headerlink" title="1.2 计算规则"></a>1.2 计算规则</h4><p>要实现个人所得税计算器，需要了解如下计算规则：</p>
<table>
<thead>
<tr>
<th align="left">规则编号</th>
<th align="left">名称</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1</td>
<td align="left">计算应纳税所得额</td>
<td align="left">应纳税所得额为税前工资减去3500</td>
</tr>
<tr>
<td align="left">2</td>
<td align="left">设置税率，应纳税所得额&lt;=1500</td>
<td align="left">税率为0.03，速算扣除数为0</td>
</tr>
<tr>
<td align="left">3</td>
<td align="left">设置税率，应纳税所得额在1500至4500之间</td>
<td align="left">税率为0.1，速算扣除数为105</td>
</tr>
<tr>
<td align="left">4</td>
<td align="left">设置税率，应纳税所得额在4500志9000之间</td>
<td align="left">税率为0.2，速算扣除数为555</td>
</tr>
<tr>
<td align="left">5</td>
<td align="left">设置税率，应纳税所得额在9000志35000之间</td>
<td align="left">税率为0.25，速算扣除数为1005</td>
</tr>
<tr>
<td align="left">6</td>
<td align="left">设置税率，应纳税所得额在35000至55000之间</td>
<td align="left">税率为0.3，速算扣除数为2755</td>
</tr>
<tr>
<td align="left">7</td>
<td align="left">设置税率，应纳税所得额在55000至80000之间</td>
<td align="left">税率为0.35，速算扣除数为5505</td>
</tr>
<tr>
<td align="left">8</td>
<td align="left">设置税率，应纳税所得额在80000以上</td>
<td align="left">税率为0.45，速算扣除数为13505</td>
</tr>
<tr>
<td align="left">9</td>
<td align="left">计算税后工资</td>
<td align="left">扣税额=应纳税所得额*税率-速算扣除数 税后工资=税前工资-扣税额</td>
</tr>
</tbody></table>
<h4 id="1-3-实现步骤"><a href="#1-3-实现步骤" class="headerlink" title="1.3 实现步骤"></a>1.3 实现步骤</h4><p>本实战案例我们基于Spring Boot整合Drools的方式来实现。</p>
<p>第一步：创建maven工程calculation并配置pom.xml文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;</span><br><span class="line">         xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br><span class="line">         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;</span><br><span class="line">    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;</span><br><span class="line">    &lt;parent&gt;</span><br><span class="line">        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;spring-boot-starters&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;2.0.6.RELEASE&lt;/version&gt;</span><br><span class="line">    &lt;/parent&gt;</span><br><span class="line">    &lt;groupId&gt;cn.itcast&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;calculation&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;</span><br><span class="line">    &lt;dependencies&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-aop&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;commons-lang&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;commons-lang&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;2.6&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;!--drools规则引擎--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.drools&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;drools-core&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;7.6.0.Final&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.drools&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;drools-compiler&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;7.6.0.Final&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.drools&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;drools-templates&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;7.6.0.Final&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.kie&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;kie-api&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;7.6.0.Final&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.kie&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;kie-spring&lt;/artifactId&gt;</span><br><span class="line">            &lt;exclusions&gt;</span><br><span class="line">                &lt;exclusion&gt;</span><br><span class="line">                    &lt;groupId&gt;org.springframework&lt;/groupId&gt;</span><br><span class="line">                    &lt;artifactId&gt;spring-tx&lt;/artifactId&gt;</span><br><span class="line">                &lt;/exclusion&gt;</span><br><span class="line">                &lt;exclusion&gt;</span><br><span class="line">                    &lt;groupId&gt;org.springframework&lt;/groupId&gt;</span><br><span class="line">                    &lt;artifactId&gt;spring-beans&lt;/artifactId&gt;</span><br><span class="line">                &lt;/exclusion&gt;</span><br><span class="line">                &lt;exclusion&gt;</span><br><span class="line">                    &lt;groupId&gt;org.springframework&lt;/groupId&gt;</span><br><span class="line">                    &lt;artifactId&gt;spring-core&lt;/artifactId&gt;</span><br><span class="line">                &lt;/exclusion&gt;</span><br><span class="line">                &lt;exclusion&gt;</span><br><span class="line">                    &lt;groupId&gt;org.springframework&lt;/groupId&gt;</span><br><span class="line">                    &lt;artifactId&gt;spring-context&lt;/artifactId&gt;</span><br><span class="line">                &lt;/exclusion&gt;</span><br><span class="line">            &lt;/exclusions&gt;</span><br><span class="line">            &lt;version&gt;7.6.0.Final&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">    &lt;/dependencies&gt;</span><br><span class="line">    &lt;build&gt;</span><br><span class="line">        &lt;finalName&gt;$&#123;project.artifactId&#125;&lt;/finalName&gt;</span><br><span class="line">        &lt;resources&gt;</span><br><span class="line">            &lt;resource&gt;</span><br><span class="line">                &lt;directory&gt;src/main/java&lt;/directory&gt;</span><br><span class="line">                &lt;includes&gt;</span><br><span class="line">                    &lt;include&gt;**/*.xml&lt;/include&gt;</span><br><span class="line">                &lt;/includes&gt;</span><br><span class="line">                &lt;filtering&gt;false&lt;/filtering&gt;</span><br><span class="line">            &lt;/resource&gt;</span><br><span class="line">            &lt;resource&gt;</span><br><span class="line">                &lt;directory&gt;src/main/resources&lt;/directory&gt;</span><br><span class="line">                &lt;includes&gt;</span><br><span class="line">                    &lt;include&gt;**/*.*&lt;/include&gt;</span><br><span class="line">                &lt;/includes&gt;</span><br><span class="line">                &lt;filtering&gt;false&lt;/filtering&gt;</span><br><span class="line">            &lt;/resource&gt;</span><br><span class="line">        &lt;/resources&gt;</span><br><span class="line">        &lt;plugins&gt;</span><br><span class="line">            &lt;plugin&gt;</span><br><span class="line">                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;</span><br><span class="line">                &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;</span><br><span class="line">                &lt;version&gt;2.3.2&lt;/version&gt;</span><br><span class="line">                &lt;configuration&gt;</span><br><span class="line">                    &lt;source&gt;1.8&lt;/source&gt;</span><br><span class="line">                    &lt;target&gt;1.8&lt;/target&gt;</span><br><span class="line">                &lt;/configuration&gt;</span><br><span class="line">            &lt;/plugin&gt;</span><br><span class="line">        &lt;/plugins&gt;</span><br><span class="line">    &lt;/build&gt;</span><br><span class="line">&lt;/project&gt;</span><br></pre></td></tr></table></figure>

<p>第二步：创建/resources/application.yml文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">server:</span><br><span class="line">  port: 8080</span><br><span class="line">spring:</span><br><span class="line">  application:</span><br><span class="line">    name: calculation</span><br></pre></td></tr></table></figure>

<p>第三步：编写配置类DroolsConfig</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">package com.itheima.drools.config;</span><br><span class="line">import org.kie.api.KieBase;</span><br><span class="line">import org.kie.api.KieServices;</span><br><span class="line">import org.kie.api.builder.KieBuilder;</span><br><span class="line">import org.kie.api.builder.KieFileSystem;</span><br><span class="line">import org.kie.api.builder.KieRepository;</span><br><span class="line">import org.kie.api.runtime.KieContainer;</span><br><span class="line">import org.kie.api.runtime.KieSession;</span><br><span class="line">import org.kie.internal.io.ResourceFactory;</span><br><span class="line">import org.kie.spring.KModuleBeanFactoryPostProcessor;</span><br><span class="line">import org.springframework.boot.autoconfigure.condition.ConditionalOnMissingBean;</span><br><span class="line">import org.springframework.context.annotation.Bean;</span><br><span class="line">import org.springframework.context.annotation.Configuration;</span><br><span class="line">import org.springframework.core.io.support.PathMatchingResourcePatternResolver;</span><br><span class="line">import org.springframework.core.io.support.ResourcePatternResolver;</span><br><span class="line">import org.springframework.core.io.Resource;</span><br><span class="line">import java.io.IOException;</span><br><span class="line">/**</span><br><span class="line"> * 规则引擎配置类</span><br><span class="line"> */</span><br><span class="line">@Configuration</span><br><span class="line">public class DroolsConfig &#123;</span><br><span class="line">    //指定规则文件存放的目录</span><br><span class="line">    private static final String RULES_PATH = &quot;rules/&quot;;</span><br><span class="line">    private final KieServices kieServices = KieServices.Factory.get();</span><br><span class="line">    @Bean</span><br><span class="line">    @ConditionalOnMissingBean</span><br><span class="line">    public KieFileSystem kieFileSystem() throws IOException &#123;</span><br><span class="line">        System.setProperty(&quot;drools.dateformat&quot;,&quot;yyyy-MM-dd&quot;);</span><br><span class="line">        KieFileSystem kieFileSystem = kieServices.newKieFileSystem();</span><br><span class="line">        ResourcePatternResolver resourcePatternResolver = </span><br><span class="line">            new PathMatchingResourcePatternResolver();</span><br><span class="line">        Resource[] files = </span><br><span class="line">            resourcePatternResolver.getResources(&quot;classpath*:&quot; + RULES_PATH + &quot;*.*&quot;);</span><br><span class="line">        String path = null;</span><br><span class="line">        for (Resource file : files) &#123;</span><br><span class="line">            path = RULES_PATH + file.getFilename();</span><br><span class="line">            kieFileSystem.write(ResourceFactory.newClassPathResource(path, &quot;UTF-8&quot;));</span><br><span class="line">        &#125;</span><br><span class="line">        return kieFileSystem;</span><br><span class="line">    &#125;</span><br><span class="line">    @Bean</span><br><span class="line">    @ConditionalOnMissingBean</span><br><span class="line">    public KieContainer kieContainer() throws IOException &#123;</span><br><span class="line">        KieRepository kieRepository = kieServices.getRepository();</span><br><span class="line">        kieRepository.addKieModule(kieRepository::getDefaultReleaseId);</span><br><span class="line">        KieBuilder kieBuilder = kieServices.newKieBuilder(kieFileSystem());</span><br><span class="line">        kieBuilder.buildAll();</span><br><span class="line">        return kieServices.newKieContainer(kieRepository.getDefaultReleaseId());</span><br><span class="line">    &#125;</span><br><span class="line">    @Bean</span><br><span class="line">    @ConditionalOnMissingBean</span><br><span class="line">    public KieBase kieBase() throws IOException &#123;</span><br><span class="line">        return kieContainer().getKieBase();</span><br><span class="line">    &#125;</span><br><span class="line">    @Bean</span><br><span class="line">    @ConditionalOnMissingBean</span><br><span class="line">    public KModuleBeanFactoryPostProcessor kiePostProcessor() &#123;</span><br><span class="line">        return new KModuleBeanFactoryPostProcessor();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>第四步：编写实体类Calculation</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line">package com.itheima.drools.entity;</span><br><span class="line"></span><br><span class="line">public class Calculation &#123;</span><br><span class="line">    private double wage;//税前工资</span><br><span class="line">    private double wagemore;//应纳税所得额</span><br><span class="line">    private double cess;//税率</span><br><span class="line">    private double preminus;//速算扣除数</span><br><span class="line">    private double wageminus;//扣税额</span><br><span class="line">    private double actualwage;//税后工资</span><br><span class="line"></span><br><span class="line">    public double getWage() &#123;</span><br><span class="line">        return wage;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setWage(double wage) &#123;</span><br><span class="line">        this.wage = wage;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public double getActualwage() &#123;</span><br><span class="line">        return actualwage;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setActualwage(double actualwage) &#123;</span><br><span class="line">        this.actualwage = actualwage;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public double getWagemore() &#123;</span><br><span class="line">        return wagemore;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setWagemore(double wagemore) &#123;</span><br><span class="line">        this.wagemore = wagemore;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public double getCess() &#123;</span><br><span class="line">        return cess;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setCess(double cess) &#123;</span><br><span class="line">        this.cess = cess;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public double getPreminus() &#123;</span><br><span class="line">        return preminus;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setPreminus(double preminus) &#123;</span><br><span class="line">        this.preminus = preminus;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public double getWageminus() &#123;</span><br><span class="line">        return wageminus;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setWageminus(double wageminus) &#123;</span><br><span class="line">        this.wageminus = wageminus;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public String toString() &#123;</span><br><span class="line">        return &quot;Calculation&#123;&quot; +</span><br><span class="line">                &quot;wage=&quot; + wage +</span><br><span class="line">                &quot;, actualwage=&quot; + actualwage +</span><br><span class="line">                &quot;, wagemore=&quot; + wagemore +</span><br><span class="line">                &quot;, cess=&quot; + cess +</span><br><span class="line">                &quot;, preminus=&quot; + preminus +</span><br><span class="line">                &quot;, wageminus=&quot; + wageminus +</span><br><span class="line">                &#x27;&#125;&#x27;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>第五步：在resources/rules下创建规则文件calculation.drl文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line">package calculation</span><br><span class="line">import com.itheima.drools.entity.Calculation</span><br><span class="line"></span><br><span class="line">rule &quot;个人所得税：计算应纳税所得额&quot;</span><br><span class="line">    enabled true</span><br><span class="line">    salience 3</span><br><span class="line">    no-loop true</span><br><span class="line">    date-effective &quot;2011-09-01&quot; //生效日期</span><br><span class="line">    when</span><br><span class="line">        $cal : Calculation(wage&gt;0)</span><br><span class="line">    then</span><br><span class="line">        $cal.setWagemore($cal.getWage()-3500);</span><br><span class="line">        update($cal);</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">rule &quot;个人所得税：设置税率--&gt;&gt;应纳税所得额&lt;=1500&quot;</span><br><span class="line">    salience 2</span><br><span class="line">    no-loop true</span><br><span class="line">    activation-group &quot;SETCess_Group&quot;</span><br><span class="line">    when</span><br><span class="line">        $cal : Calculation(wagemore &lt;= 1500)</span><br><span class="line">    then</span><br><span class="line">        $cal.setCess(0.03);</span><br><span class="line">        $cal.setPreminus(0);</span><br><span class="line">        update($cal);</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">rule &quot;个人所得税：设置税率--&gt;&gt;应纳税所得额在1500至4500之间&quot;</span><br><span class="line">    salience 2</span><br><span class="line">    no-loop true</span><br><span class="line">    activation-group &quot;SETCess_Group&quot;</span><br><span class="line">    when</span><br><span class="line">        $cal : Calculation(wagemore &gt; 1500 &amp;&amp; wagemore &lt;= 4500)</span><br><span class="line">    then</span><br><span class="line">        $cal.setCess(0.1);</span><br><span class="line">        $cal.setPreminus(105);</span><br><span class="line">        update($cal);</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">rule &quot;个人所得税：设置税率--&gt;&gt;应纳税所得额在4500志9000之间&quot;</span><br><span class="line">    salience 2</span><br><span class="line">    no-loop true</span><br><span class="line">    activation-group &quot;SETCess_Group&quot;</span><br><span class="line">    when</span><br><span class="line">        $cal : Calculation(wagemore &gt; 4500 &amp;&amp; wagemore &lt;= 9000)</span><br><span class="line">    then</span><br><span class="line">        $cal.setCess(0.2);</span><br><span class="line">        $cal.setPreminus(555);</span><br><span class="line">        update($cal);</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">rule &quot;个人所得税：设置税率--&gt;&gt;应纳税所得额在9000志35000之间&quot;</span><br><span class="line">    salience 2</span><br><span class="line">    no-loop true</span><br><span class="line">    activation-group &quot;SETCess_Group&quot;</span><br><span class="line">    when</span><br><span class="line">        $cal : Calculation(wagemore &gt; 9000 &amp;&amp; wagemore &lt;= 35000)</span><br><span class="line">    then</span><br><span class="line">        $cal.setCess(0.25);</span><br><span class="line">        $cal.setPreminus(1005);</span><br><span class="line">        update($cal);</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">rule &quot;个人所得税：设置税率--&gt;&gt;应纳税所得额在35000至55000之间&quot;</span><br><span class="line">    salience 2</span><br><span class="line">    no-loop true</span><br><span class="line">    activation-group &quot;SETCess_Group&quot;</span><br><span class="line">    when</span><br><span class="line">        $cal : Calculation(wagemore &gt; 35000 &amp;&amp; wagemore &lt;= 55000)</span><br><span class="line">    then</span><br><span class="line">        $cal.setCess(0.3);</span><br><span class="line">        $cal.setPreminus(2755);</span><br><span class="line">        update($cal);</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">rule &quot;个人所得税：设置税率--&gt;&gt;应纳税所得额在55000至80000之间&quot;</span><br><span class="line">    salience 2</span><br><span class="line">    no-loop true</span><br><span class="line">    activation-group &quot;SETCess_Group&quot;</span><br><span class="line">    when</span><br><span class="line">        $cal : Calculation(wagemore &gt; 55000 &amp;&amp; wagemore &lt;= 80000)</span><br><span class="line">    then</span><br><span class="line">        $cal.setCess(0.35);</span><br><span class="line">        $cal.setPreminus(5505);</span><br><span class="line">        update($cal);</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">rule &quot;个人所得税：设置税率--&gt;&gt;应纳税所得额在80000以上&quot;</span><br><span class="line">    salience 2</span><br><span class="line">    no-loop true</span><br><span class="line">    activation-group &quot;SETCess_Group&quot;</span><br><span class="line">    when</span><br><span class="line">        $cal : Calculation(wagemore &gt; 80000)</span><br><span class="line">    then</span><br><span class="line">        $cal.setCess(0.45);</span><br><span class="line">        $cal.setPreminus(13505);</span><br><span class="line">        update($cal);</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">rule &quot;个人所得税：计算税后工资&quot;</span><br><span class="line">    salience 1</span><br><span class="line">    when</span><br><span class="line">        $cal : Calculation(wage &gt; 0 &amp;&amp; wagemore &gt; 0 &amp;&amp; wagemore &gt; 0 &amp;&amp; cess &gt; 0)</span><br><span class="line">    then</span><br><span class="line">        $cal.setWageminus($cal.getWagemore()*$cal.getCess()-$cal.getPreminus());</span><br><span class="line">        $cal.setActualwage($cal.getWage()-$cal.getWageminus());</span><br><span class="line"></span><br><span class="line">        System.out.println(&quot;-----税前工资：&quot;+$cal.getWage());</span><br><span class="line">        System.out.println(&quot;-----应纳税所得额：&quot;+$cal.getWagemore());</span><br><span class="line">        System.out.println(&quot;-----税率：&quot; + $cal.getCess());</span><br><span class="line">        System.out.println(&quot;-----速算扣除数：&quot; + $cal.getPreminus());</span><br><span class="line">        System.out.println(&quot;-----扣税额：&quot; + $cal.getWageminus());</span><br><span class="line">        System.out.println(&quot;-----税后工资：&quot; + $cal.getActualwage());</span><br><span class="line">end</span><br></pre></td></tr></table></figure>

<p>第六步：创建RuleService</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">package com.itheima.drools.service;</span><br><span class="line"></span><br><span class="line">import com.itheima.drools.entity.Calculation;</span><br><span class="line">import org.kie.api.KieBase;</span><br><span class="line">import org.kie.api.runtime.KieSession;</span><br><span class="line">import org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line">import org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 调用规则引擎，执行规则</span><br><span class="line"> */</span><br><span class="line">@Service</span><br><span class="line">public class RuleService &#123;</span><br><span class="line">    @Autowired</span><br><span class="line">    private KieBase kieBase;</span><br><span class="line"></span><br><span class="line">    //个人所得税计算</span><br><span class="line">    public Calculation calculate(Calculation calculation)&#123;</span><br><span class="line">        KieSession kieSession = kieBase.newKieSession();</span><br><span class="line">        kieSession.insert(calculation);</span><br><span class="line">        kieSession.fireAllRules();</span><br><span class="line">        kieSession.dispose();</span><br><span class="line">        return calculation;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>第七步：创建RuleController</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">package com.itheima.drools.controller;</span><br><span class="line"></span><br><span class="line">import com.itheima.drools.entity.Calculation;</span><br><span class="line">import com.itheima.drools.service.RuleService;</span><br><span class="line">import org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line">import org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line">import org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line">@RestController</span><br><span class="line">@RequestMapping(&quot;/rule&quot;)</span><br><span class="line">public class RuleController &#123;</span><br><span class="line">    @Autowired</span><br><span class="line">    private RuleService ruleService;</span><br><span class="line"></span><br><span class="line">    @RequestMapping(&quot;/calculate&quot;)</span><br><span class="line">    public Calculation calculate(double wage)&#123;</span><br><span class="line">        Calculation calculation = new Calculation();</span><br><span class="line">        calculation.setWage(wage);</span><br><span class="line">        calculation = ruleService.calculate(calculation);</span><br><span class="line">        System.out.println(calculation);</span><br><span class="line">        return calculation;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>第八步：创建启动类DroolsApplication</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">package com.itheima.drools;</span><br><span class="line"></span><br><span class="line">import org.springframework.boot.SpringApplication;</span><br><span class="line">import org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"></span><br><span class="line">@SpringBootApplication</span><br><span class="line">public class DroolsApplication &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        SpringApplication.run(DroolsApplication.class);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>第九步：导入静态资源文件到resources/static目录下</p>
<h3 id="2-信用卡申请"><a href="#2-信用卡申请" class="headerlink" title="2 信用卡申请"></a>2 信用卡申请</h3><p>本小节我们需要通过Drools规则引擎来根据规则进行申请人的合法性检查，检查通过后再根据规则确定信用卡额度，最终页面效果如下：</p>
<p><img src="/2021/07/08/%EF%BC%88%E4%B8%83%EF%BC%89drools%E5%AE%9E%E6%88%98%E5%BC%80%E5%8F%91%E6%A1%88%E4%BE%8B/image-20200214202525859.png"></p>
<h4 id="2-1-计算规则"><a href="#2-1-计算规则" class="headerlink" title="2.1 计算规则"></a>2.1 计算规则</h4><p>合法性检查规则如下：</p>
<table>
<thead>
<tr>
<th align="left">规则编号</th>
<th align="left">名称</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1</td>
<td align="left">检查学历与薪水1</td>
<td align="left">如果申请人既没房也没车，同时学历为大专以下，并且月薪少于5000，那么不通过</td>
</tr>
<tr>
<td align="left">2</td>
<td align="left">检查学历与薪水2</td>
<td align="left">如果申请人既没房也没车，同时学历为大专或本科，并且月薪少于3000，那么不通过</td>
</tr>
<tr>
<td align="left">3</td>
<td align="left">检查学历与薪水3</td>
<td align="left">如果申请人既没房也没车，同时学历为本科以上，并且月薪少于2000，同时之前没有信用卡的，那么不通过</td>
</tr>
<tr>
<td align="left">4</td>
<td align="left">检查申请人已有的信用卡数量</td>
<td align="left">如果申请人现有的信用卡数量大于10，那么不通过</td>
</tr>
</tbody></table>
<p>信用卡额度确定规则：</p>
<table>
<thead>
<tr>
<th align="left">规则编号</th>
<th align="left">名称</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1</td>
<td align="left">规则1</td>
<td align="left">如果申请人有房有车，或者月收入在20000以上，那么发放的信用卡额度为15000</td>
</tr>
<tr>
<td align="left">2</td>
<td align="left">规则2</td>
<td align="left">如果申请人没房没车，但月收入在10000~20000之间，那么发放的信用卡额度为6000</td>
</tr>
<tr>
<td align="left">3</td>
<td align="left">规则3</td>
<td align="left">如果申请人没房没车，月收入在10000以下，那么发放的信用卡额度为3000</td>
</tr>
<tr>
<td align="left">4</td>
<td align="left">规则4</td>
<td align="left">如果申请人有房没车或者没房但有车，月收入在10000以下，那么发放的信用卡额度为5000</td>
</tr>
<tr>
<td align="left">5</td>
<td align="left">规则5</td>
<td align="left">如果申请人有房没车或者是没房但有车，月收入在10000~20000之间，那么发放的信用卡额度为8000</td>
</tr>
</tbody></table>
<h4 id="2-2-实现步骤"><a href="#2-2-实现步骤" class="headerlink" title="2.2 实现步骤"></a>2.2 实现步骤</h4><p>第一步：创建maven工程creditCardApply并配置pom.xml文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;</span><br><span class="line">         xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br><span class="line">         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;</span><br><span class="line">    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;</span><br><span class="line">    &lt;parent&gt;</span><br><span class="line">        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;spring-boot-starters&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;2.0.6.RELEASE&lt;/version&gt;</span><br><span class="line">    &lt;/parent&gt;</span><br><span class="line">    &lt;groupId&gt;com.itheima&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;creditCardApply&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;</span><br><span class="line">    &lt;dependencies&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-aop&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;commons-lang&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;commons-lang&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;2.6&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;!--drools规则引擎--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.drools&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;drools-core&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;7.6.0.Final&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.drools&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;drools-compiler&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;7.6.0.Final&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.drools&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;drools-templates&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;7.6.0.Final&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.kie&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;kie-api&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;7.6.0.Final&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.kie&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;kie-spring&lt;/artifactId&gt;</span><br><span class="line">            &lt;exclusions&gt;</span><br><span class="line">                &lt;exclusion&gt;</span><br><span class="line">                    &lt;groupId&gt;org.springframework&lt;/groupId&gt;</span><br><span class="line">                    &lt;artifactId&gt;spring-tx&lt;/artifactId&gt;</span><br><span class="line">                &lt;/exclusion&gt;</span><br><span class="line">                &lt;exclusion&gt;</span><br><span class="line">                    &lt;groupId&gt;org.springframework&lt;/groupId&gt;</span><br><span class="line">                    &lt;artifactId&gt;spring-beans&lt;/artifactId&gt;</span><br><span class="line">                &lt;/exclusion&gt;</span><br><span class="line">                &lt;exclusion&gt;</span><br><span class="line">                    &lt;groupId&gt;org.springframework&lt;/groupId&gt;</span><br><span class="line">                    &lt;artifactId&gt;spring-core&lt;/artifactId&gt;</span><br><span class="line">                &lt;/exclusion&gt;</span><br><span class="line">                &lt;exclusion&gt;</span><br><span class="line">                    &lt;groupId&gt;org.springframework&lt;/groupId&gt;</span><br><span class="line">                    &lt;artifactId&gt;spring-context&lt;/artifactId&gt;</span><br><span class="line">                &lt;/exclusion&gt;</span><br><span class="line">            &lt;/exclusions&gt;</span><br><span class="line">            &lt;version&gt;7.6.0.Final&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">    &lt;/dependencies&gt;</span><br><span class="line">    &lt;build&gt;</span><br><span class="line">        &lt;finalName&gt;$&#123;project.artifactId&#125;&lt;/finalName&gt;</span><br><span class="line">        &lt;resources&gt;</span><br><span class="line">            &lt;resource&gt;</span><br><span class="line">                &lt;directory&gt;src/main/java&lt;/directory&gt;</span><br><span class="line">                &lt;includes&gt;</span><br><span class="line">                    &lt;include&gt;**/*.xml&lt;/include&gt;</span><br><span class="line">                &lt;/includes&gt;</span><br><span class="line">                &lt;filtering&gt;false&lt;/filtering&gt;</span><br><span class="line">            &lt;/resource&gt;</span><br><span class="line">            &lt;resource&gt;</span><br><span class="line">                &lt;directory&gt;src/main/resources&lt;/directory&gt;</span><br><span class="line">                &lt;includes&gt;</span><br><span class="line">                    &lt;include&gt;**/*.*&lt;/include&gt;</span><br><span class="line">                &lt;/includes&gt;</span><br><span class="line">                &lt;filtering&gt;false&lt;/filtering&gt;</span><br><span class="line">            &lt;/resource&gt;</span><br><span class="line">        &lt;/resources&gt;</span><br><span class="line">        &lt;plugins&gt;</span><br><span class="line">            &lt;plugin&gt;</span><br><span class="line">                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;</span><br><span class="line">                &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;</span><br><span class="line">                &lt;version&gt;2.3.2&lt;/version&gt;</span><br><span class="line">                &lt;configuration&gt;</span><br><span class="line">                    &lt;source&gt;1.8&lt;/source&gt;</span><br><span class="line">                    &lt;target&gt;1.8&lt;/target&gt;</span><br><span class="line">                &lt;/configuration&gt;</span><br><span class="line">            &lt;/plugin&gt;</span><br><span class="line">        &lt;/plugins&gt;</span><br><span class="line">    &lt;/build&gt;</span><br><span class="line">&lt;/project&gt;</span><br></pre></td></tr></table></figure>

<p>第二步：创建/resources/application.yml文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">server:</span><br><span class="line">  port: 8080</span><br><span class="line">spring:</span><br><span class="line">  application:</span><br><span class="line">    name: creditCardApply</span><br></pre></td></tr></table></figure>

<p>第三步：编写配置类DroolsConfig</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">package com.itheima.drools.config;</span><br><span class="line">import org.kie.api.KieBase;</span><br><span class="line">import org.kie.api.KieServices;</span><br><span class="line">import org.kie.api.builder.KieBuilder;</span><br><span class="line">import org.kie.api.builder.KieFileSystem;</span><br><span class="line">import org.kie.api.builder.KieRepository;</span><br><span class="line">import org.kie.api.runtime.KieContainer;</span><br><span class="line">import org.kie.api.runtime.KieSession;</span><br><span class="line">import org.kie.internal.io.ResourceFactory;</span><br><span class="line">import org.kie.spring.KModuleBeanFactoryPostProcessor;</span><br><span class="line">import org.springframework.boot.autoconfigure.condition.ConditionalOnMissingBean;</span><br><span class="line">import org.springframework.context.annotation.Bean;</span><br><span class="line">import org.springframework.context.annotation.Configuration;</span><br><span class="line">import org.springframework.core.io.support.PathMatchingResourcePatternResolver;</span><br><span class="line">import org.springframework.core.io.support.ResourcePatternResolver;</span><br><span class="line">import org.springframework.core.io.Resource;</span><br><span class="line">import java.io.IOException;</span><br><span class="line">/**</span><br><span class="line"> * 规则引擎配置类</span><br><span class="line"> */</span><br><span class="line">@Configuration</span><br><span class="line">public class DroolsConfig &#123;</span><br><span class="line">    //指定规则文件存放的目录</span><br><span class="line">    private static final String RULES_PATH = &quot;rules/&quot;;</span><br><span class="line">    private final KieServices kieServices = KieServices.Factory.get();</span><br><span class="line">    @Bean</span><br><span class="line">    @ConditionalOnMissingBean</span><br><span class="line">    public KieFileSystem kieFileSystem() throws IOException &#123;</span><br><span class="line">        KieFileSystem kieFileSystem = kieServices.newKieFileSystem();</span><br><span class="line">        ResourcePatternResolver resourcePatternResolver =</span><br><span class="line">                new PathMatchingResourcePatternResolver();</span><br><span class="line">        Resource[] files =</span><br><span class="line">                resourcePatternResolver.getResources(&quot;classpath*:&quot; + RULES_PATH + &quot;*.*&quot;);</span><br><span class="line">        String path = null;</span><br><span class="line">        for (Resource file : files) &#123;</span><br><span class="line">            path = RULES_PATH + file.getFilename();</span><br><span class="line">            kieFileSystem.write(ResourceFactory.newClassPathResource(path, &quot;UTF-8&quot;));</span><br><span class="line">        &#125;</span><br><span class="line">        return kieFileSystem;</span><br><span class="line">    &#125;</span><br><span class="line">    @Bean</span><br><span class="line">    @ConditionalOnMissingBean</span><br><span class="line">    public KieContainer kieContainer() throws IOException &#123;</span><br><span class="line">        KieRepository kieRepository = kieServices.getRepository();</span><br><span class="line">        kieRepository.addKieModule(kieRepository::getDefaultReleaseId);</span><br><span class="line">        KieBuilder kieBuilder = kieServices.newKieBuilder(kieFileSystem());</span><br><span class="line">        kieBuilder.buildAll();</span><br><span class="line">        return kieServices.newKieContainer(kieRepository.getDefaultReleaseId());</span><br><span class="line">    &#125;</span><br><span class="line">    @Bean</span><br><span class="line">    @ConditionalOnMissingBean</span><br><span class="line">    public KieBase kieBase() throws IOException &#123;</span><br><span class="line">        return kieContainer().getKieBase();</span><br><span class="line">    &#125;</span><br><span class="line">    @Bean</span><br><span class="line">    @ConditionalOnMissingBean</span><br><span class="line">    public KModuleBeanFactoryPostProcessor kiePostProcessor() &#123;</span><br><span class="line">        return new KModuleBeanFactoryPostProcessor();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>第四步：编写实体类CreditCardApplyInfo</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br></pre></td><td class="code"><pre><span class="line">package com.itheima.drools.entity;</span><br><span class="line">/**</span><br><span class="line"> * 信用卡申请信息</span><br><span class="line"> */</span><br><span class="line">public class CreditCardApplyInfo &#123;</span><br><span class="line">    public static final String EDUCATION_1 = &quot;专科以下&quot;;</span><br><span class="line">    public static final String EDUCATION_2 = &quot;专科&quot;;</span><br><span class="line">    public static final String EDUCATION_3 = &quot;本科&quot;;</span><br><span class="line">    public static final String EDUCATION_4 = &quot;本科以上&quot;;</span><br><span class="line"></span><br><span class="line">    private String name;</span><br><span class="line">    private String sex;</span><br><span class="line">    private int age;</span><br><span class="line">    private String education;</span><br><span class="line">    private String telephone;</span><br><span class="line">    private double monthlyIncome = 0;//月收入</span><br><span class="line">    private String address;</span><br><span class="line"></span><br><span class="line">    private boolean hasHouse = false;//是否有房</span><br><span class="line">    private boolean hasCar = false;//是否有车</span><br><span class="line">    private int hasCreditCardCount = 0;//现持有信用卡数量</span><br><span class="line"></span><br><span class="line">    private boolean checkResult = true;//审核是否通过</span><br><span class="line">    private double quota = 0;//额度</span><br><span class="line"></span><br><span class="line">    public String getName() &#123;</span><br><span class="line">        return name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setName(String name) &#123;</span><br><span class="line">        this.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getSex() &#123;</span><br><span class="line">        return sex;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setSex(String sex) &#123;</span><br><span class="line">        this.sex = sex;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public int getAge() &#123;</span><br><span class="line">        return age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setAge(int age) &#123;</span><br><span class="line">        this.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getEducation() &#123;</span><br><span class="line">        return education;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setEducation(String education) &#123;</span><br><span class="line">        this.education = education;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getTelephone() &#123;</span><br><span class="line">        return telephone;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setTelephone(String telephone) &#123;</span><br><span class="line">        this.telephone = telephone;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public double getMonthlyIncome() &#123;</span><br><span class="line">        return monthlyIncome;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setMonthlyIncome(double monthlyIncome) &#123;</span><br><span class="line">        this.monthlyIncome = monthlyIncome;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getAddress() &#123;</span><br><span class="line">        return address;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setAddress(String address) &#123;</span><br><span class="line">        this.address = address;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public boolean isHasHouse() &#123;</span><br><span class="line">        return hasHouse;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setHasHouse(boolean hasHouse) &#123;</span><br><span class="line">        this.hasHouse = hasHouse;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public boolean isHasCar() &#123;</span><br><span class="line">        return hasCar;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setHasCar(boolean hasCar) &#123;</span><br><span class="line">        this.hasCar = hasCar;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public int getHasCreditCardCount() &#123;</span><br><span class="line">        return hasCreditCardCount;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setHasCreditCardCount(int hasCreditCardCount) &#123;</span><br><span class="line">        this.hasCreditCardCount = hasCreditCardCount;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public boolean isCheckResult() &#123;</span><br><span class="line">        return checkResult;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setCheckResult(boolean checkResult) &#123;</span><br><span class="line">        this.checkResult = checkResult;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public double getQuota() &#123;</span><br><span class="line">        return quota;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setQuota(double quota) &#123;</span><br><span class="line">        this.quota = quota;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String toString() &#123;</span><br><span class="line">        if(checkResult)&#123;</span><br><span class="line">            return &quot;审核通过，信用卡额度为：&quot; + quota;</span><br><span class="line">        &#125;else &#123;</span><br><span class="line">            return &quot;审核不通过&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>第五步：在resources/rules下创建规则文件creditCardApply.drl文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line">package com.itheima.creditCardApply</span><br><span class="line">import com.itheima.drools.entity.CreditCardApplyInfo</span><br><span class="line"></span><br><span class="line">//合法性检查</span><br><span class="line">rule &quot;如果申请人既没房也没车，同时学历为大专以下，并且月薪少于5000，那么不通过&quot;</span><br><span class="line">    salience 10</span><br><span class="line">    no-loop true</span><br><span class="line">    when</span><br><span class="line">        $c:CreditCardApplyInfo(hasCar == false &amp;&amp;</span><br><span class="line">                                hasHouse == false &amp;&amp;</span><br><span class="line">                                education == CreditCardApplyInfo.EDUCATION_1 &amp;&amp;</span><br><span class="line">                                monthlyIncome &lt; 5000)</span><br><span class="line">    then</span><br><span class="line">        $c.setCheckResult(false);</span><br><span class="line">        drools.halt();</span><br><span class="line">end</span><br><span class="line">rule &quot;如果申请人既没房也没车，同时学历为大专或本科，并且月薪少于3000，那么不通过&quot;</span><br><span class="line">    salience 10</span><br><span class="line">    no-loop true</span><br><span class="line">    when</span><br><span class="line">        $c:CreditCardApplyInfo(hasCar == false &amp;&amp;</span><br><span class="line">                                hasHouse == false &amp;&amp;</span><br><span class="line">                                (education == CreditCardApplyInfo.EDUCATION_2  ||</span><br><span class="line">                                education == CreditCardApplyInfo.EDUCATION_3) &amp;&amp;</span><br><span class="line">                                monthlyIncome &lt; 3000)</span><br><span class="line">    then</span><br><span class="line">        $c.setCheckResult(false);</span><br><span class="line">        drools.halt();</span><br><span class="line">end</span><br><span class="line">rule &quot;如果申请人既没房也没车，同时学历为本科以上，并且月薪少于2000，同时之前没有信用卡的，那么不通过&quot;</span><br><span class="line">    salience 10</span><br><span class="line">    no-loop true</span><br><span class="line">    when</span><br><span class="line">        $c:CreditCardApplyInfo(hasCar == false &amp;&amp;</span><br><span class="line">                                hasHouse == false &amp;&amp;</span><br><span class="line">                                education == CreditCardApplyInfo.EDUCATION_4 &amp;&amp;</span><br><span class="line">                                monthlyIncome &lt; 2000 &amp;&amp;</span><br><span class="line">                                hasCreditCardCount == 0)</span><br><span class="line">    then</span><br><span class="line">        $c.setCheckResult(false);</span><br><span class="line">        drools.halt();</span><br><span class="line">end</span><br><span class="line">rule &quot;如果申请人现有的信用卡数量大于10，那么不通过&quot;</span><br><span class="line">    salience 10</span><br><span class="line">    no-loop true</span><br><span class="line">    when</span><br><span class="line">        $c:CreditCardApplyInfo(hasCreditCardCount &gt; 10)</span><br><span class="line">    then</span><br><span class="line">        $c.setCheckResult(false);</span><br><span class="line">        drools.halt();</span><br><span class="line">end</span><br><span class="line">//--------------------------------------------------------------------------</span><br><span class="line">//确定额度</span><br><span class="line">rule &quot;如果申请人有房有车，或者月收入在20000以上，那么发放的信用卡额度为15000&quot;</span><br><span class="line">    salience 1</span><br><span class="line">    no-loop true</span><br><span class="line">    activation-group &quot;quota_group&quot;</span><br><span class="line">    when</span><br><span class="line">        $c:CreditCardApplyInfo(checkResult == true &amp;&amp;</span><br><span class="line">                                ((hasHouse == true &amp;&amp; hasCar == true) ||</span><br><span class="line">                                (monthlyIncome &gt; 20000)))</span><br><span class="line">    then</span><br><span class="line">        $c.setQuota(15000);</span><br><span class="line">end</span><br><span class="line">rule &quot;如果申请人没房没车，但月收入在10000~20000之间，那么发放的信用卡额度为6000&quot;</span><br><span class="line">    salience 1</span><br><span class="line">    no-loop true</span><br><span class="line">    activation-group &quot;quota_group&quot;</span><br><span class="line">    when</span><br><span class="line">        $c:CreditCardApplyInfo(checkResult == true &amp;&amp;</span><br><span class="line">                                hasHouse == false &amp;&amp;</span><br><span class="line">                                hasCar == false &amp;&amp;</span><br><span class="line">                                monthlyIncome &gt;= 10000 &amp;&amp;</span><br><span class="line">                                monthlyIncome &lt;= 20000)</span><br><span class="line">    then</span><br><span class="line">        $c.setQuota(6000);</span><br><span class="line">end</span><br><span class="line">rule &quot;如果申请人没房没车，月收入在10000以下，那么发放的信用卡额度为3000&quot;</span><br><span class="line">    salience 1</span><br><span class="line">    no-loop true</span><br><span class="line">    activation-group &quot;quota_group&quot;</span><br><span class="line">    when</span><br><span class="line">        $c:CreditCardApplyInfo(checkResult == true &amp;&amp;</span><br><span class="line">                                        hasHouse == false &amp;&amp;</span><br><span class="line">                                        hasCar == false &amp;&amp;</span><br><span class="line">                                        monthlyIncome &lt; 10000)</span><br><span class="line">    then</span><br><span class="line">        $c.setQuota(3000);</span><br><span class="line">end</span><br><span class="line">rule &quot;如果申请人有房没车或者没房但有车，月收入在10000以下，那么发放的信用卡额度为5000&quot;</span><br><span class="line">    salience 1</span><br><span class="line">    no-loop true</span><br><span class="line">    activation-group &quot;quota_group&quot;</span><br><span class="line">    when</span><br><span class="line">        $c:CreditCardApplyInfo(checkResult == true &amp;&amp;</span><br><span class="line">                                ((hasHouse == true &amp;&amp; hasCar == false) ||</span><br><span class="line">                                (hasHouse == false &amp;&amp; hasCar == true)) &amp;&amp;</span><br><span class="line">                                monthlyIncome &lt; 10000)</span><br><span class="line">    then</span><br><span class="line">        $c.setQuota(5000);</span><br><span class="line">end</span><br><span class="line">rule &quot;如果申请人有房没车或者是没房但有车，月收入在10000~20000之间，那么发放的信用卡额度为8000&quot;</span><br><span class="line">    salience 1</span><br><span class="line">    no-loop true</span><br><span class="line">    activation-group &quot;quota_group&quot;</span><br><span class="line">    when</span><br><span class="line">        $c:CreditCardApplyInfo(checkResult == true &amp;&amp;</span><br><span class="line">                                ((hasHouse == true &amp;&amp; hasCar == false) ||</span><br><span class="line">                                (hasHouse == false &amp;&amp; hasCar == true)) &amp;&amp;</span><br><span class="line">                                monthlyIncome &gt;= 10000 &amp;&amp;</span><br><span class="line">                                monthlyIncome &lt;= 20000)</span><br><span class="line">    then</span><br><span class="line">        $c.setQuota(8000);</span><br><span class="line">end</span><br></pre></td></tr></table></figure>

<p>第六步：创建RuleService</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">package com.itheima.drools.service;</span><br><span class="line"></span><br><span class="line">import com.itheima.drools.entity.CreditCardApplyInfo;</span><br><span class="line">import org.kie.api.KieBase;</span><br><span class="line">import org.kie.api.runtime.KieSession;</span><br><span class="line">import org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line">import org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line">@Service</span><br><span class="line">public class RuleService &#123;</span><br><span class="line">    @Autowired</span><br><span class="line">    private KieBase kieBase;</span><br><span class="line"></span><br><span class="line">    //调用Drools规则引擎实现信用卡申请</span><br><span class="line">    public CreditCardApplyInfo creditCardApply(CreditCardApplyInfo creditCardApplyInfo)&#123;</span><br><span class="line">        KieSession session = kieBase.newKieSession();</span><br><span class="line">        session.insert(creditCardApplyInfo);</span><br><span class="line">        session.fireAllRules();</span><br><span class="line">        session.dispose();</span><br><span class="line">        return creditCardApplyInfo;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>第七步：创建RuleController</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">package com.itheima.drools.controller;</span><br><span class="line"></span><br><span class="line">import com.itheima.drools.entity.CreditCardApplyInfo;</span><br><span class="line">import com.itheima.drools.service.RuleService;</span><br><span class="line">import org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line">import org.springframework.web.bind.annotation.RequestBody;</span><br><span class="line">import org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line">import org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line">@RestController</span><br><span class="line">@RequestMapping(&quot;/rule&quot;)</span><br><span class="line">public class RuleController &#123;</span><br><span class="line">    @Autowired</span><br><span class="line">    private RuleService ruleService;</span><br><span class="line"></span><br><span class="line">    @RequestMapping(&quot;/creditCardApply&quot;)</span><br><span class="line">    public CreditCardApplyInfo creditCardApply(@RequestBody </span><br><span class="line">        CreditCardApplyInfo creditCardApplyInfo)&#123;</span><br><span class="line">        creditCardApplyInfo = ruleService.creditCardApply(creditCardApplyInfo);</span><br><span class="line">        return creditCardApplyInfo;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>第八步：创建启动类DroolsApplication</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">package com.itheima.drools;</span><br><span class="line"></span><br><span class="line">import org.springframework.boot.SpringApplication;</span><br><span class="line">import org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"></span><br><span class="line">@SpringBootApplication</span><br><span class="line">public class DroolsApplication &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        SpringApplication.run(DroolsApplication.class);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>第九步：导入静态资源文件到resources/static目录下</p>
<h3 id="3-保险产品准入规则"><a href="#3-保险产品准入规则" class="headerlink" title="3 保险产品准入规则"></a>3 保险产品准入规则</h3><h4 id="3-1-决策表"><a href="#3-1-决策表" class="headerlink" title="3.1 决策表"></a>3.1 决策表</h4><p>前面的课程中我们编写的规则文件都是drl形式的文件，Drools除了支持drl形式的文件外还支持xls格式的文件（即Excel文件）。这种xls格式的文件通常称为决策表（decision table）。</p>
<p>决策表（decision table）是一个“精确而紧凑的”表示条件逻辑的方式，非常适合商业级别的规则。决策表与现有的drl文件可以无缝替换。Drools提供了相应的API可以将xls文件编译为drl格式的字符串。</p>
<p>一个决策表的例子如下：</p>
<p><img src="/2021/07/08/%EF%BC%88%E4%B8%83%EF%BC%89drools%E5%AE%9E%E6%88%98%E5%BC%80%E5%8F%91%E6%A1%88%E4%BE%8B/image-20200217160930138.png"></p>
<p>决策表语法：</p>
<table>
<thead>
<tr>
<th align="left">关键字</th>
<th align="left">说明</th>
<th align="left">是否必须</th>
</tr>
</thead>
<tbody><tr>
<td align="left">RuleSet</td>
<td align="left">相当于drl文件中的package</td>
<td align="left">必须，只能有一个。如果没有设置RuleSet对应的值则使用默认值rule_table</td>
</tr>
<tr>
<td align="left">Sequential</td>
<td align="left">取值为Boolean类型。true表示规则按照表格自上到下的顺序执行，false表示乱序</td>
<td align="left">可选</td>
</tr>
<tr>
<td align="left">Import</td>
<td align="left">相当于drl文件中的import，如果引入多个类则类之间用逗号分隔</td>
<td align="left">可选</td>
</tr>
<tr>
<td align="left">Variables</td>
<td align="left">相当于drl文件中的global，用于定义全局变量，如果有多个全局变量则中间用逗号分隔</td>
<td align="left">可选</td>
</tr>
<tr>
<td align="left">RuleTable</td>
<td align="left">它指示了后面将会有一批rule，RuleTable的名称将会作为以后生成rule的前缀</td>
<td align="left">必须</td>
</tr>
<tr>
<td align="left">CONDITION</td>
<td align="left">规则条件关键字，相当于drl文件中的when。下面两行则表示 LHS 部分，第三行则为注释行，不计为规则部分，从第四行开始，每一行表示一条规则</td>
<td align="left">每个规则表至少有一个</td>
</tr>
<tr>
<td align="left">ACTION</td>
<td align="left">规则结果关键字，相当于drl文件中的then</td>
<td align="left">每个规则表至少有一个</td>
</tr>
<tr>
<td align="left">NO-LOOP</td>
<td align="left">相当于drl文件中的no-loop</td>
<td align="left">可选</td>
</tr>
<tr>
<td align="left">AGENDA-GROUP</td>
<td align="left">相当于drl文件中的agenda-group</td>
<td align="left">可选</td>
</tr>
</tbody></table>
<p>在决策表中还经常使用到占位符，语法为$后面加数字，用于替换每条规则中设置的具体值。</p>
<p>上面的决策表例子转换为drl格式的规则文件内容如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">package rules;</span><br><span class="line"></span><br><span class="line">import com.itheima.drools.entity.PersonInfoEntity;</span><br><span class="line">import java.util.List;</span><br><span class="line">global java.util.List listRules;</span><br><span class="line"></span><br><span class="line">rule &quot;personCheck_10&quot;</span><br><span class="line">    salience 65535</span><br><span class="line">    agenda-group &quot;sign&quot;</span><br><span class="line">    when</span><br><span class="line">        $person : PersonInfoEntity(sex != &quot;男&quot;)</span><br><span class="line">    then</span><br><span class="line">        listRules.add(&quot;性别不对&quot;);</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">rule &quot;personCheck_11&quot;</span><br><span class="line">    salience 65534</span><br><span class="line">    agenda-group &quot;sign&quot;</span><br><span class="line">    when</span><br><span class="line">        $person : PersonInfoEntity(age &lt; 22 || age &gt; 25)</span><br><span class="line">    then</span><br><span class="line">        listRules.add(&quot;年龄不合适&quot;);</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">rule &quot;personCheck_12&quot;</span><br><span class="line">    salience 65533</span><br><span class="line">    agenda-group &quot;sign&quot;</span><br><span class="line">    when</span><br><span class="line">        $person : PersonInfoEntity(salary &lt; 10000)</span><br><span class="line">    then</span><br><span class="line">        listRules.add(&quot;工资太低了&quot;);</span><br><span class="line">end</span><br></pre></td></tr></table></figure>

<p>要进行决策表相关操作，需要导入如下maven坐标：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.drools&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;drools-decisiontables&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;7.10.0.Final&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<p>通过下图可以发现，由于maven的依赖传递特性在导入drools-decisiontables坐标后，drools-core和drools-compiler等坐标也被传递了过来</p>
<p><img src="/2021/07/08/%EF%BC%88%E4%B8%83%EF%BC%89drools%E5%AE%9E%E6%88%98%E5%BC%80%E5%8F%91%E6%A1%88%E4%BE%8B/image-20200218105819932.png"></p>
<p>Drools提供的将xls文件编译为drl格式字符串的API如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">String realPath = &quot;C:\\testRule.xls&quot;;//指定决策表xls文件的磁盘路径</span><br><span class="line">File file = new File(realPath);</span><br><span class="line">InputStream is = new FileInputStream(file);</span><br><span class="line">SpreadsheetCompiler compiler = new SpreadsheetCompiler();</span><br><span class="line">String drl = compiler.compile(is, InputType.XLS);</span><br></pre></td></tr></table></figure>

<p>Drools还提供了基于drl格式字符串创建KieSession的API：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">KieHelper kieHelper = new KieHelper();</span><br><span class="line">kieHelper.addContent(drl, ResourceType.DRL);</span><br><span class="line">KieSession session = kieHelper.build().newKieSession();</span><br></pre></td></tr></table></figure>

<p>基于决策表的入门案例：</p>
<p>第一步：创建maven工程drools_decisiontable_demo并配置pom.xml文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.drools&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;drools-decisiontables&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;7.10.0.Final&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;junit&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;junit&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;4.12&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<p>第二步：创建实体类PersonInfoEntity</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">package com.itheima.drools.entity;</span><br><span class="line"></span><br><span class="line">public class PersonInfoEntity &#123;</span><br><span class="line">    private String sex;</span><br><span class="line">    private int age;</span><br><span class="line">    private double salary;</span><br><span class="line"></span><br><span class="line">    public String getSex() &#123;</span><br><span class="line">        return sex;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setSex(String sex) &#123;</span><br><span class="line">        this.sex = sex;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public int getAge() &#123;</span><br><span class="line">        return age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setAge(int age) &#123;</span><br><span class="line">        this.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public double getSalary() &#123;</span><br><span class="line">        return salary;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setSalary(double salary) &#123;</span><br><span class="line">        this.salary = salary;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>第三步：创建xls规则文件（可以直接使用资料中提供的testRule.xls文件）</p>
<p>第四步：创建单元测试</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void test1() throws Exception&#123;</span><br><span class="line">    String realPath = &quot;d:\\testRule.xls&quot;;//指定决策表xls文件的磁盘路径</span><br><span class="line">    File file = new File(realPath);</span><br><span class="line">    InputStream is = new FileInputStream(file);</span><br><span class="line">    SpreadsheetCompiler compiler = new SpreadsheetCompiler();</span><br><span class="line">    String drl = compiler.compile(is, InputType.XLS);</span><br><span class="line"></span><br><span class="line">    System.out.println(drl);</span><br><span class="line">    KieHelper kieHelper = new KieHelper();</span><br><span class="line">    kieHelper.addContent(drl, ResourceType.DRL);</span><br><span class="line">    KieSession session = kieHelper.build().newKieSession();</span><br><span class="line"></span><br><span class="line">    PersonInfoEntity personInfoEntity = new PersonInfoEntity();</span><br><span class="line">    personInfoEntity.setSex(&quot;男&quot;);</span><br><span class="line">    personInfoEntity.setAge(35);</span><br><span class="line">    personInfoEntity.setSalary(1000);</span><br><span class="line"></span><br><span class="line">    List&lt;String&gt; list = new ArrayList&lt;String&gt;();</span><br><span class="line">    session.setGlobal(&quot;listRules&quot;,list);</span><br><span class="line"></span><br><span class="line">    session.insert(personInfoEntity);</span><br><span class="line">    </span><br><span class="line">    session.getAgenda().getAgendaGroup(&quot;sign&quot;).setFocus();</span><br><span class="line">    </span><br><span class="line">    session.fireAllRules();</span><br><span class="line"></span><br><span class="line">    for (String s : list) &#123;</span><br><span class="line">        System.out.println(s);</span><br><span class="line">    &#125;</span><br><span class="line">    session.dispose();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-2-规则介绍"><a href="#3-2-规则介绍" class="headerlink" title="3.2 规则介绍"></a>3.2 规则介绍</h4><p>各保险公司针对人身、财产推出了不同的保险产品，作为商业保险公司，筛选出符合公司利益最大化的客户是非常重要的，即各保险产品的准入人群是不同的，也就是说保险公司会针对不同的人群特征，制定不同的产品缴费和赔付规则。</p>
<p>我们来看一下某保险产品准入规则的简化版，当不满足以下规则时，系统模块需要返回准入失败标识和失败原因</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">规则1：  保险公司是：PICC</span><br><span class="line">规则2：  销售区域是：北京、天津</span><br><span class="line">规则3：  投保人年龄：0 ~ 17岁</span><br><span class="line">规则4：  保险期间是：20年、25年、30年</span><br><span class="line">规则5：  缴费方式是：趸交（一次性交清）或年交</span><br><span class="line">规则6：  保险期与交费期规则一：保险期间为20年期交费期间最长10年交且不能选择[趸交]</span><br><span class="line">规则7：  保险期与交费期规则二：保险期间为25年期交费期间最长15年交且不能选择[趸交]</span><br><span class="line">规则8：  保险期与交费期规则三：保险期间为30年期交费期间最长20年交且不能选择[趸交]</span><br><span class="line">规则9：  被保人要求：（投保年龄+保险期间）不得大于40周岁</span><br><span class="line">规则10： 保险金额规则：投保时约定，最低为5万元，超过部分必须为1000元的整数倍</span><br><span class="line">规则11： 出单基本保额限额规则：线上出单基本保额限额62.5万元，超62.5万元需配合契调转线下出单</span><br></pre></td></tr></table></figure>

<p>在本案例中规则文件是一个Excel文件，业务人员可以直接更改这个文件中指标的值，系统不需要做任何变更。</p>
<h4 id="3-3-实现步骤"><a href="#3-3-实现步骤" class="headerlink" title="3.3 实现步骤"></a>3.3 实现步骤</h4><p>本案例还是基于Spring Boot整合Drools的架构来实现。</p>
<p>第一步：创建maven工程insuranceInfoCheck并配置pom.xml文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;</span><br><span class="line">         xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br><span class="line">         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 </span><br><span class="line">                             http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;</span><br><span class="line">    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;</span><br><span class="line">    &lt;parent&gt;</span><br><span class="line">        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;spring-boot-starters&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;2.0.6.RELEASE&lt;/version&gt;</span><br><span class="line">    &lt;/parent&gt;</span><br><span class="line">    &lt;groupId&gt;com.itheima&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;insuranceInfoCheck&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;</span><br><span class="line">    &lt;dependencies&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-aop&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;commons-lang&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;commons-lang&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;2.6&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;!--drools规则引擎--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.drools&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;drools-core&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;7.6.0.Final&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.drools&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;drools-compiler&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;7.6.0.Final&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.drools&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;drools-templates&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;7.6.0.Final&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.kie&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;kie-api&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;7.6.0.Final&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.kie&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;kie-spring&lt;/artifactId&gt;</span><br><span class="line">            &lt;exclusions&gt;</span><br><span class="line">                &lt;exclusion&gt;</span><br><span class="line">                    &lt;groupId&gt;org.springframework&lt;/groupId&gt;</span><br><span class="line">                    &lt;artifactId&gt;spring-tx&lt;/artifactId&gt;</span><br><span class="line">                &lt;/exclusion&gt;</span><br><span class="line">                &lt;exclusion&gt;</span><br><span class="line">                    &lt;groupId&gt;org.springframework&lt;/groupId&gt;</span><br><span class="line">                    &lt;artifactId&gt;spring-beans&lt;/artifactId&gt;</span><br><span class="line">                &lt;/exclusion&gt;</span><br><span class="line">                &lt;exclusion&gt;</span><br><span class="line">                    &lt;groupId&gt;org.springframework&lt;/groupId&gt;</span><br><span class="line">                    &lt;artifactId&gt;spring-core&lt;/artifactId&gt;</span><br><span class="line">                &lt;/exclusion&gt;</span><br><span class="line">                &lt;exclusion&gt;</span><br><span class="line">                    &lt;groupId&gt;org.springframework&lt;/groupId&gt;</span><br><span class="line">                    &lt;artifactId&gt;spring-context&lt;/artifactId&gt;</span><br><span class="line">                &lt;/exclusion&gt;</span><br><span class="line">            &lt;/exclusions&gt;</span><br><span class="line">            &lt;version&gt;7.6.0.Final&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">    &lt;/dependencies&gt;</span><br><span class="line">    &lt;build&gt;</span><br><span class="line">        &lt;finalName&gt;$&#123;project.artifactId&#125;&lt;/finalName&gt;</span><br><span class="line">        &lt;resources&gt;</span><br><span class="line">            &lt;resource&gt;</span><br><span class="line">                &lt;directory&gt;src/main/java&lt;/directory&gt;</span><br><span class="line">                &lt;includes&gt;</span><br><span class="line">                    &lt;include&gt;**/*.xml&lt;/include&gt;</span><br><span class="line">                &lt;/includes&gt;</span><br><span class="line">                &lt;filtering&gt;false&lt;/filtering&gt;</span><br><span class="line">            &lt;/resource&gt;</span><br><span class="line">            &lt;resource&gt;</span><br><span class="line">                &lt;directory&gt;src/main/resources&lt;/directory&gt;</span><br><span class="line">                &lt;includes&gt;</span><br><span class="line">                    &lt;include&gt;**/*.*&lt;/include&gt;</span><br><span class="line">                &lt;/includes&gt;</span><br><span class="line">                &lt;filtering&gt;false&lt;/filtering&gt;</span><br><span class="line">            &lt;/resource&gt;</span><br><span class="line">        &lt;/resources&gt;</span><br><span class="line">        &lt;plugins&gt;</span><br><span class="line">            &lt;plugin&gt;</span><br><span class="line">                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;</span><br><span class="line">                &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;</span><br><span class="line">                &lt;version&gt;2.3.2&lt;/version&gt;</span><br><span class="line">                &lt;configuration&gt;</span><br><span class="line">                    &lt;source&gt;1.8&lt;/source&gt;</span><br><span class="line">                    &lt;target&gt;1.8&lt;/target&gt;</span><br><span class="line">                &lt;/configuration&gt;</span><br><span class="line">            &lt;/plugin&gt;</span><br><span class="line">        &lt;/plugins&gt;</span><br><span class="line">    &lt;/build&gt;</span><br><span class="line">&lt;/project&gt;</span><br></pre></td></tr></table></figure>

<p>第二步：创建/resources/application.yml文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">server:</span><br><span class="line">  port: 8080</span><br><span class="line">spring:</span><br><span class="line">  application:</span><br><span class="line">    name: insuranceInfoCheck</span><br></pre></td></tr></table></figure>

<p>第三步：创建实体类InsuranceInfo</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">package com.itheima.drools.entity;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 保险信息</span><br><span class="line"> */</span><br><span class="line">public class InsuranceInfo &#123;</span><br><span class="line">    private String param1;//保险公司</span><br><span class="line">    private String param2;//方案代码</span><br><span class="line">    private String param3;//渠道号</span><br><span class="line">    private String param4;//销售区域</span><br><span class="line">    private String param5;//投保年龄</span><br><span class="line">    private String param6;//保险期间</span><br><span class="line">    private String param7;//缴费期间</span><br><span class="line">    private String param8;//缴费方式</span><br><span class="line">    private String param9;//保障类型</span><br><span class="line">    private String param10;//等待期</span><br><span class="line">    private String param11;//犹豫期</span><br><span class="line">    private String param12;//职业类型</span><br><span class="line">    private String param13;//保额限制</span><br><span class="line">    private String param14;//免赔额</span><br><span class="line">    private String param15;//主险保额</span><br><span class="line">    private String param16;//主险保费</span><br><span class="line">    private String param17;//附加险保额</span><br><span class="line">    private String param18;//附加险保费</span><br><span class="line">    private String param19;//与投保人关系</span><br><span class="line">    private String param20;//与被保人关系</span><br><span class="line">    private String param21;//性别</span><br><span class="line">    private String param22;//证件</span><br><span class="line">    private String param23;//保费</span><br><span class="line">    private String param24;//保额</span><br><span class="line"></span><br><span class="line">    //getter setter省略</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>第四步：创建决策表文件（也可以直接使用实战资料中提供的insuranceInfoCheck.xls文件）</p>
<p><img src="/2021/07/08/%EF%BC%88%E4%B8%83%EF%BC%89drools%E5%AE%9E%E6%88%98%E5%BC%80%E5%8F%91%E6%A1%88%E4%BE%8B/image-20200218120618384.png"></p>
<p>第五步：封装工具类KieSessionUtils</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">package com.itheima.drools.utils;</span><br><span class="line"></span><br><span class="line">import com.itheima.drools.entity.InsuranceInfo;</span><br><span class="line">import com.itheima.drools.entity.PersonInfoEntity;</span><br><span class="line">import org.drools.decisiontable.InputType;</span><br><span class="line">import org.drools.decisiontable.SpreadsheetCompiler;</span><br><span class="line">import org.kie.api.builder.Message;</span><br><span class="line">import org.kie.api.builder.Results;</span><br><span class="line">import org.kie.api.io.ResourceType;</span><br><span class="line">import org.kie.api.runtime.KieSession;</span><br><span class="line">import org.kie.internal.utils.KieHelper;</span><br><span class="line">import java.io.File;</span><br><span class="line">import java.io.FileInputStream;</span><br><span class="line">import java.io.FileNotFoundException;</span><br><span class="line">import java.io.InputStream;</span><br><span class="line">import java.util.ArrayList;</span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line">public class KieSessionUtils &#123;</span><br><span class="line">    private KieSessionUtils() &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    // 把xls文件解析为String</span><br><span class="line">    public static String getDRL (String realPath) throws FileNotFoundException &#123;</span><br><span class="line">        File file = new File(realPath); // 例如：C:\\abc.xls</span><br><span class="line">        InputStream is = new FileInputStream(file);</span><br><span class="line">        SpreadsheetCompiler compiler = new SpreadsheetCompiler();</span><br><span class="line">        String drl = compiler.compile(is, InputType.XLS);</span><br><span class="line">        System.out.println(drl);</span><br><span class="line">        return drl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // drl为含有内容的字符串</span><br><span class="line">    public static KieSession createKieSessionFromDRL(String drl) throws Exception&#123;</span><br><span class="line">        KieHelper kieHelper = new KieHelper();</span><br><span class="line">        kieHelper.addContent(drl, ResourceType.DRL);</span><br><span class="line">        Results results = kieHelper.verify();</span><br><span class="line">        if (results.hasMessages(Message.Level.WARNING, Message.Level.ERROR)) &#123;</span><br><span class="line">            List&lt;Message&gt; messages = results.getMessages(Message.Level.WARNING, Message.Level.ERROR);</span><br><span class="line">            for (Message message : messages) &#123;</span><br><span class="line">                System.out.println(&quot;Error: &quot;+message.getText());</span><br><span class="line">            &#125;</span><br><span class="line">            // throw new IllegalStateException(&quot;Compilation errors were found. Check the logs.&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        return kieHelper.build().newKieSession();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // realPath为Excel文件绝对路径</span><br><span class="line">    public static KieSession getKieSessionFromXLS(String realPath) throws Exception &#123;</span><br><span class="line">        return createKieSessionFromDRL(getDRL(realPath));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>第六步：创建RuleService类</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">package com.itheima.drools.service;</span><br><span class="line"></span><br><span class="line">import com.itheima.drools.entity.InsuranceInfo;</span><br><span class="line">import com.itheima.drools.utils.KieSessionUtils;</span><br><span class="line">import org.kie.api.runtime.KieSession;</span><br><span class="line">import org.springframework.stereotype.Service;</span><br><span class="line">import java.util.ArrayList;</span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line">@Service</span><br><span class="line">public class RuleService &#123;</span><br><span class="line">    public List&lt;String&gt; insuranceInfoCheck(InsuranceInfo insuranceInfo) throws Exception&#123;</span><br><span class="line">        KieSession session = KieSessionUtils.getKieSessionFromXLS(&quot;D:\\rules.xls&quot;);</span><br><span class="line">        session.getAgenda().getAgendaGroup(&quot;sign&quot;).setFocus();</span><br><span class="line"></span><br><span class="line">        session.insert(insuranceInfo);</span><br><span class="line"></span><br><span class="line">        List&lt;String&gt; listRules = new ArrayList&lt;&gt;();</span><br><span class="line">        session.setGlobal(&quot;listRules&quot;, listRules);</span><br><span class="line"></span><br><span class="line">        session.fireAllRules();</span><br><span class="line">        </span><br><span class="line">        return listRules;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>第七步：创建RuleController类</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">package com.itheima.drools.controller;</span><br><span class="line"></span><br><span class="line">import com.itheima.drools.entity.InsuranceInfo;</span><br><span class="line">import com.itheima.drools.service.RuleService;</span><br><span class="line">import org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line">import org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line">import org.springframework.web.bind.annotation.RestController;</span><br><span class="line">import java.util.HashMap;</span><br><span class="line">import java.util.List;</span><br><span class="line">import java.util.Map;</span><br><span class="line"></span><br><span class="line">@RestController</span><br><span class="line">@RequestMapping(&quot;/rule&quot;)</span><br><span class="line">public class RuleController &#123;</span><br><span class="line">    @Autowired</span><br><span class="line">    private RuleService ruleService;</span><br><span class="line"></span><br><span class="line">    @RequestMapping(&quot;/insuranceInfoCheck&quot;)</span><br><span class="line">    public Map insuranceInfoCheck()&#123;</span><br><span class="line">        Map map = new HashMap();</span><br><span class="line">        </span><br><span class="line">        //模拟数据，实际应为页面传递过来</span><br><span class="line">        InsuranceInfo insuranceInfo = new InsuranceInfo();</span><br><span class="line">        insuranceInfo.setParam1(&quot;picc&quot;);</span><br><span class="line">        insuranceInfo.setParam4(&quot;上海&quot;);</span><br><span class="line">        insuranceInfo.setParam5(&quot;101&quot;);</span><br><span class="line">        insuranceInfo.setParam6(&quot;12&quot;);</span><br><span class="line">        insuranceInfo.setParam7(&quot;222&quot;);</span><br><span class="line">        insuranceInfo.setParam8(&quot;1&quot;);</span><br><span class="line">        insuranceInfo.setParam13(&quot;3&quot;);</span><br><span class="line">        </span><br><span class="line">        try &#123;</span><br><span class="line">            List&lt;String&gt; list = ruleService.insuranceInfoCheck(insuranceInfo);</span><br><span class="line">            if(list != null &amp;&amp; list.size() &gt; 0)&#123;</span><br><span class="line">                map.put(&quot;checkResult&quot;,false);</span><br><span class="line">                map.put(&quot;msg&quot;,&quot;准入失败&quot;);</span><br><span class="line">                map.put(&quot;detail&quot;,list);</span><br><span class="line">            &#125;else&#123;</span><br><span class="line">                map.put(&quot;checkResult&quot;,true);</span><br><span class="line">                map.put(&quot;msg&quot;,&quot;准入成功&quot;);</span><br><span class="line">            &#125;</span><br><span class="line">            return map;</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            map.put(&quot;checkResult&quot;,false);</span><br><span class="line">            map.put(&quot;msg&quot;,&quot;未知错误&quot;);</span><br><span class="line">            return map;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>第八步：创建启动类DroolsApplication</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">package com.itheima.drools;</span><br><span class="line"></span><br><span class="line">import org.springframework.boot.SpringApplication;</span><br><span class="line">import org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"></span><br><span class="line">@SpringBootApplication</span><br><span class="line">public class DroolsApplication &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        SpringApplication.run(DroolsApplication.class);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Diao HaiYuan</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://diaohaiyuan.github.io/2021/07/08/%EF%BC%88%E4%B8%83%EF%BC%89drools%E5%AE%9E%E6%88%98%E5%BC%80%E5%8F%91%E6%A1%88%E4%BE%8B/">https://diaohaiyuan.github.io/2021/07/08/%EF%BC%88%E4%B8%83%EF%BC%89drools%E5%AE%9E%E6%88%98%E5%BC%80%E5%8F%91%E6%A1%88%E4%BE%8B/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://diaohaiyuan.github.io" target="_blank">海元的小站</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E8%A7%84%E5%88%99%E5%BC%95%E6%93%8E/">规则引擎</a><a class="post-meta__tags" href="/tags/drools/">drools</a></div><div class="post_share"><div class="social-share" data-image="/2021/07/08/%EF%BC%88%E4%B8%83%EF%BC%89drools%E5%AE%9E%E6%88%98%E5%BC%80%E5%8F%91%E6%A1%88%E4%BE%8B/drools.webp" data-sites="wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2021/07/23/leetcode-20%E5%A4%A9-%E7%AE%97%E6%B3%95-%E5%88%B7%E9%A2%98%E8%AE%A1%E5%88%92/"><img class="prev-cover" src="/2021/07/23/leetcode-20%E5%A4%A9-%E7%AE%97%E6%B3%95-%E5%88%B7%E9%A2%98%E8%AE%A1%E5%88%92/leetcode.webp" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">leetcode-20天[算法]刷题计划</div></div></a></div><div class="next-post pull-right"><a href="/2021/07/07/%EF%BC%88%E5%85%AD%EF%BC%89drools%E5%8F%AF%E8%A7%86%E5%8C%96%E8%A7%84%E5%88%99%E7%BC%96%E8%BE%91%E5%99%A8WorkBench%E5%AE%89%E8%A3%85/"><img class="next-cover" src="/2021/07/07/%EF%BC%88%E5%85%AD%EF%BC%89drools%E5%8F%AF%E8%A7%86%E5%8C%96%E8%A7%84%E5%88%99%E7%BC%96%E8%BE%91%E5%99%A8WorkBench%E5%AE%89%E8%A3%85/drools.webp" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">（六）drools可视化规则编辑器WorkBench安装</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span> 相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2021/07/07/（一）drools规则引擎介绍/" title="（一）drools规则引擎介绍"><img class="cover" src="/2021/07/07/%EF%BC%88%E4%B8%80%EF%BC%89drools%E8%A7%84%E5%88%99%E5%BC%95%E6%93%8E%E4%BB%8B%E7%BB%8D/drools.webp" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-07-07</div><div class="title">（一）drools规则引擎介绍</div></div></a></div><div><a href="/2021/07/07/（二）drools入门案例/" title="（二）drools入门案例"><img class="cover" src="/2021/07/07/%EF%BC%88%E4%BA%8C%EF%BC%89drools%E5%85%A5%E9%97%A8%E6%A1%88%E4%BE%8B/drools.webp" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-07-07</div><div class="title">（二）drools入门案例</div></div></a></div><div><a href="/2021/07/07/（六）drools可视化规则编辑器WorkBench安装/" title="（六）drools可视化规则编辑器WorkBench安装"><img class="cover" src="/2021/07/07/%EF%BC%88%E5%85%AD%EF%BC%89drools%E5%8F%AF%E8%A7%86%E5%8C%96%E8%A7%84%E5%88%99%E7%BC%96%E8%BE%91%E5%99%A8WorkBench%E5%AE%89%E8%A3%85/drools.webp" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-07-07</div><div class="title">（六）drools可视化规则编辑器WorkBench安装</div></div></a></div><div><a href="/2021/07/07/（四）drools高级语法/" title="（四）drools高级语法"><img class="cover" src="/2021/07/07/%EF%BC%88%E5%9B%9B%EF%BC%89drools%E9%AB%98%E7%BA%A7%E8%AF%AD%E6%B3%95/drools.webp" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-07-07</div><div class="title">（四）drools高级语法</div></div></a></div><div><a href="/2021/07/07/（三）drools基础语法和规则属性/" title="（三）drools基础语法和规则属性"><img class="cover" src="/2021/07/07/%EF%BC%88%E4%B8%89%EF%BC%89drools%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95%E5%92%8C%E8%A7%84%E5%88%99%E5%B1%9E%E6%80%A7/drools.webp" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-07-07</div><div class="title">（三）drools基础语法和规则属性</div></div></a></div><div><a href="/2021/07/07/（五）Spring整合drools/" title="（五）Spring整合drools"><img class="cover" src="/2021/07/07/%EF%BC%88%E4%BA%94%EF%BC%89Spring%E6%95%B4%E5%90%88drools/drools.webp" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-07-07</div><div class="title">（五）Spring整合drools</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-info-avatar is-center"><img class="avatar-img" src="/img/touxiang.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-info__name">Diao HaiYuan</div><div class="author-info__description"></div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">22</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">标签</div><div class="length-num">31</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">分类</div><div class="length-num">15</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="tencent://message/?uin=1343186932&amp;Site=&amp;Menu=yes" target="_blank" title="QQ"><i class="fab fa-qq"></i></a><a class="social-icon" href="https://gitee.com/diaohaiyuan" target="_blank" title="Gitee"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:lucky_diao@qq.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>公告</span></div><div class="announcement_content">Welcome to my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Drools%E5%AE%9E%E6%88%98%E5%BC%80%E5%8F%91%E6%A1%88%E4%BE%8B"><span class="toc-text">Drools实战开发案例</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E4%B8%AA%E4%BA%BA%E6%89%80%E5%BE%97%E7%A8%8E%E8%AE%A1%E7%AE%97%E5%99%A8"><span class="toc-text">1 个人所得税计算器</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-%E5%90%8D%E8%AF%8D%E8%A7%A3%E9%87%8A"><span class="toc-text">1.1 名词解释</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-%E8%AE%A1%E7%AE%97%E8%A7%84%E5%88%99"><span class="toc-text">1.2 计算规则</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-%E5%AE%9E%E7%8E%B0%E6%AD%A5%E9%AA%A4"><span class="toc-text">1.3 实现步骤</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E4%BF%A1%E7%94%A8%E5%8D%A1%E7%94%B3%E8%AF%B7"><span class="toc-text">2 信用卡申请</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-%E8%AE%A1%E7%AE%97%E8%A7%84%E5%88%99"><span class="toc-text">2.1 计算规则</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-%E5%AE%9E%E7%8E%B0%E6%AD%A5%E9%AA%A4"><span class="toc-text">2.2 实现步骤</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E4%BF%9D%E9%99%A9%E4%BA%A7%E5%93%81%E5%87%86%E5%85%A5%E8%A7%84%E5%88%99"><span class="toc-text">3 保险产品准入规则</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-%E5%86%B3%E7%AD%96%E8%A1%A8"><span class="toc-text">3.1 决策表</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-%E8%A7%84%E5%88%99%E4%BB%8B%E7%BB%8D"><span class="toc-text">3.2 规则介绍</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-%E5%AE%9E%E7%8E%B0%E6%AD%A5%E9%AA%A4"><span class="toc-text">3.3 实现步骤</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2021/07/23/leetcode-20%E5%A4%A9-%E7%AE%97%E6%B3%95-%E5%88%B7%E9%A2%98%E8%AE%A1%E5%88%92/" title="leetcode-20天[算法]刷题计划"><img src="/2021/07/23/leetcode-20%E5%A4%A9-%E7%AE%97%E6%B3%95-%E5%88%B7%E9%A2%98%E8%AE%A1%E5%88%92/leetcode.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="leetcode-20天[算法]刷题计划"/></a><div class="content"><a class="title" href="/2021/07/23/leetcode-20%E5%A4%A9-%E7%AE%97%E6%B3%95-%E5%88%B7%E9%A2%98%E8%AE%A1%E5%88%92/" title="leetcode-20天[算法]刷题计划">leetcode-20天[算法]刷题计划</a><time datetime="2021-07-23T01:56:11.000Z" title="发表于 2021-07-23 09:56:11">2021-07-23</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/07/08/%EF%BC%88%E4%B8%83%EF%BC%89drools%E5%AE%9E%E6%88%98%E5%BC%80%E5%8F%91%E6%A1%88%E4%BE%8B/" title="（七）drools实战开发案例"><img src="/2021/07/08/%EF%BC%88%E4%B8%83%EF%BC%89drools%E5%AE%9E%E6%88%98%E5%BC%80%E5%8F%91%E6%A1%88%E4%BE%8B/drools.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="（七）drools实战开发案例"/></a><div class="content"><a class="title" href="/2021/07/08/%EF%BC%88%E4%B8%83%EF%BC%89drools%E5%AE%9E%E6%88%98%E5%BC%80%E5%8F%91%E6%A1%88%E4%BE%8B/" title="（七）drools实战开发案例">（七）drools实战开发案例</a><time datetime="2021-07-08T06:57:38.000Z" title="发表于 2021-07-08 14:57:38">2021-07-08</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/07/07/%EF%BC%88%E5%85%AD%EF%BC%89drools%E5%8F%AF%E8%A7%86%E5%8C%96%E8%A7%84%E5%88%99%E7%BC%96%E8%BE%91%E5%99%A8WorkBench%E5%AE%89%E8%A3%85/" title="（六）drools可视化规则编辑器WorkBench安装"><img src="/2021/07/07/%EF%BC%88%E5%85%AD%EF%BC%89drools%E5%8F%AF%E8%A7%86%E5%8C%96%E8%A7%84%E5%88%99%E7%BC%96%E8%BE%91%E5%99%A8WorkBench%E5%AE%89%E8%A3%85/drools.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="（六）drools可视化规则编辑器WorkBench安装"/></a><div class="content"><a class="title" href="/2021/07/07/%EF%BC%88%E5%85%AD%EF%BC%89drools%E5%8F%AF%E8%A7%86%E5%8C%96%E8%A7%84%E5%88%99%E7%BC%96%E8%BE%91%E5%99%A8WorkBench%E5%AE%89%E8%A3%85/" title="（六）drools可视化规则编辑器WorkBench安装">（六）drools可视化规则编辑器WorkBench安装</a><time datetime="2021-07-07T08:19:45.000Z" title="发表于 2021-07-07 16:19:45">2021-07-07</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/07/07/%EF%BC%88%E4%BA%94%EF%BC%89Spring%E6%95%B4%E5%90%88drools/" title="（五）Spring整合drools"><img src="/2021/07/07/%EF%BC%88%E4%BA%94%EF%BC%89Spring%E6%95%B4%E5%90%88drools/drools.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="（五）Spring整合drools"/></a><div class="content"><a class="title" href="/2021/07/07/%EF%BC%88%E4%BA%94%EF%BC%89Spring%E6%95%B4%E5%90%88drools/" title="（五）Spring整合drools">（五）Spring整合drools</a><time datetime="2021-07-07T08:08:16.000Z" title="发表于 2021-07-07 16:08:16">2021-07-07</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/07/07/%EF%BC%88%E5%9B%9B%EF%BC%89drools%E9%AB%98%E7%BA%A7%E8%AF%AD%E6%B3%95/" title="（四）drools高级语法"><img src="/2021/07/07/%EF%BC%88%E5%9B%9B%EF%BC%89drools%E9%AB%98%E7%BA%A7%E8%AF%AD%E6%B3%95/drools.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="（四）drools高级语法"/></a><div class="content"><a class="title" href="/2021/07/07/%EF%BC%88%E5%9B%9B%EF%BC%89drools%E9%AB%98%E7%BA%A7%E8%AF%AD%E6%B3%95/" title="（四）drools高级语法">（四）drools高级语法</a><time datetime="2021-07-07T08:01:17.000Z" title="发表于 2021-07-07 16:01:17">2021-07-07</time></div></div></div></div></div></div></main><footer id="footer" style="background-color: transparent;"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2021 By Diao HaiYuan</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: 'BobBbjH91kkqanCCX4iznqWF-gzGzoHsz',
      appKey: 'OyrdpTwbtvnfem4rLcTurt82',
      placeholder: '评论一下~',
      avatar: 'monsterid',
      meta: 'nick,mail,link'.split(','),
      pageSize: '10',
      lang: 'zh-CN',
      recordIP: false,
      serverURLs: '',
      emojiCDN: '',
      emojiMaps: "",
      enableQQ: true,
      path: window.location.pathname,
      requiredFields: ["nick,mail"],
      visitor: false
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !true) {
  if (true) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script></div><script src="/js/chocolate.js"></script><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-nest.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = false;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>